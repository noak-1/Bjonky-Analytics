<div id="top_device" data-name="{{ profileName }}"></div>
<br>
<input type="button" id="refresh-devices" value="Refresh"></input>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script>

    document.getElementById('refresh-devices').addEventListener('click', refreshWidgetPages)
    function refreshWidgetPages(){

        let xhrpages = new XMLHttpRequest();
        xhrpages.open('GET', '/actions/bjonky/default/devices?numberOfDays={{ numberOfDays }}');
        //xhr.responseType = 'json';
        xhrpages.send();
        xhrpages.onprogress = function () {
            console.log('READYSTATE: ', xhrpages.readyState)
        }
        xhrpages.onload = function() {
            if(this.status == 200) {

                var devices = xhrpages.response;

                google.charts.load('current', {'packages': ['corechart']});
                google.charts.setOnLoadCallback(drawChart);
                var deviceCategory = JSON.parse(devices);
                var profileName = document.getElementById('top_device').getAttribute('data-name');

                for (var i = 0; i < deviceCategory.length; i++) {
                    deviceCategory[i][1] = parseInt(deviceCategory[i][1]);
                }

                deviceCategory.unshift(['rubrik1', 'rubrik2']);
                console.log('hej!', deviceCategory);

                function drawChart() {

                    var data = google.visualization.arrayToDataTable(deviceCategory

                        /*[
                                    ['Task', 'Hours per Day'],
                                    ['Work',     11],
                                    ['Eat',      2],
                                    ['Commute',  2],
                                    ['Watch TV', 2],
                                    ['Sleep',    7]
                                ]*/
                    );

                    var options = {
                        title: 'Device usage for the last {{ numberOfDays }} days',
                        subtitle:'${profileName}',
                        titleTextStyle: {
                            color: "#757575",
                            fontName: "Roboto",
                            fontSize: 14,
                            bold: false,
                            italic: false
                        }
                    };

                    var chart = new google.visualization.PieChart(document.getElementById('top_device'));

                    chart.draw(data, options);
                }

            }
        }
    }
    refreshWidgetPages();




</script>